(function(){"use strict";function e(){t.add("pagebreak",function(e){u.register(e),f.register(e),g.setup(e),p.setup(e)})}var t=tinymce.util.Tools.resolve("tinymce.PluginManager"),a=tinymce.util.Tools.resolve("tinymce.Env"),n=function(e){return e.getParam("pagebreak_separator","<!--nextpage-->")},r=function(e){return e.getParam("pagebreak_split_block",!1)},o={getSeparatorHtml:n,shouldSplitBlock:r},i=function(){return"mce-pagebreak"},c=function(){return'<img src="'+a.transparentSrc+'" class="'+i()+'" data-mce-resize="false" data-mce-placeholder />'},l=function(e){var t=o.getSeparatorHtml(e),a=new RegExp(t.replace(/[\?\.\*\[\]\(\)\{\}\+\^\$\:]/g,function(e){return"\\"+e}),"gi");e.on("BeforeSetContent",function(e){e.content=e.content.replace(a,c())}),e.on("PreInit",function(){e.serializer.addNodeFilter("img",function(a){for(var n,r,i=a.length;i--;)if(n=a[i],r=n.attr("class"),r&&-1!==r.indexOf("mce-pagebreak")){var c=n.parent;if(e.schema.getBlockElements()[c.name]&&o.shouldSplitBlock(e)){c.type=3,c.value=t,c.raw=!0,n.remove();continue}n.type=3,n.value=t,n.raw=!0}})})},g={setup:l,getPlaceholderHtml:c,getPageBreakClass:i},s=function(e){e.addCommand("mcePageBreak",function(){e.settings.pagebreak_split_block?e.insertContent("<p>"+g.getPlaceholderHtml()+"</p>"):e.insertContent(g.getPlaceholderHtml())})},u={register:s},m=function(e){e.on("ResolveName",function(t){"IMG"===t.target.nodeName&&e.dom.hasClass(t.target,g.getPageBreakClass())&&(t.name="pagebreak")})},p={setup:m},d=function(e){e.ui.registry.addButton("pagebreak",{icon:"page-break",tooltip:"Page break",onAction:function(){return e.execCommand("mcePageBreak")}}),e.ui.registry.addMenuItem("pagebreak",{text:"Page break",icon:"page-break",onAction:function(){return e.execCommand("mcePageBreak")}})},f={register:d};e()})();